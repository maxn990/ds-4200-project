<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Players Analytics 2024-2025</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2d6a4f 0%, #1b4332 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 60px;
        }

        h2 {
            color: #2d6a4f;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2d6a4f;
        }

        h3 {
            color: #40916c;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }

        p {
            margin-bottom: 15px;
            font-size: 1.05em;
            text-align: justify;
        }

        .chart-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.4em;
            color: #2d6a4f;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .chart-description {
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }

        .slider-container {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slider-label span {
            font-weight: bold;
            color: #2d6a4f;
            font-size: 16px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2d6a4f;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2d6a4f;
            cursor: pointer;
            border: none;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border-radius: 5px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .axis-label {
            font-size: 14px;
            fill: #666;
        }

        .bar {
            transition: opacity 0.3s;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .point {
            opacity: 0.7;
            transition: opacity 0.3s, r 0.3s;
        }

        .point:hover {
            opacity: 1;
        }

        .grid-line {
            stroke: #e0e0e0;
            stroke-width: 1;
        }

        .axis {
            font-size: 12px;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #333;
            shape-rendering: crispEdges;
        }

        .references {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .references a {
            color: #2d6a4f;
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            transition: transform 0.2s;
        }

        .references a:hover {
            transform: translateX(10px);
            background: #d4edda;
        }

        .key-findings {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 30px;
            border-radius: 8px;
            border-left: 5px solid #2d6a4f;
        }

        .key-findings ul {
            margin-left: 30px;
            margin-top: 15px;
        }

        .key-findings li {
            margin: 15px 0;
            font-size: 1.1em;
        }

        footer {
            background: #2d6a4f;
            color: white;
            text-align: center;
            padding: 30px;
        }

        .data-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #ffc107;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öΩ Football Players Analytics 2024-2025</h1>
            <p>A Comprehensive Analysis of European Football Performance Metrics</p>
        </header>

        <div class="content">
            <!-- Introduction Section -->
            <section id="introduction">
                <h2>üìä Project Overview</h2>
                <p>
                    This project presents a comprehensive analysis of football player performance across Europe's top five leagues during the 2024-2025 season. By examining key performance indicators such as goals, assists, shots, and expected goals (xG), we aim to uncover patterns in player efficiency and effectiveness. Understanding these metrics is crucial for talent scouting, team strategy development, and fan engagement. Our analysis combines statistical rigor with interactive visualizations to make complex performance data accessible and actionable.
                </p>
                <p>
                    Football analytics has revolutionized how teams evaluate players and make strategic decisions. This project explores efficiency metrics like goals per minute and shot conversion rates, which provide deeper insights than traditional counting statistics. By analyzing data from Premier League, La Liga, Serie A, Bundesliga, and Ligue 1, we can identify the most efficient scorers and understand how different leagues compare in terms of attacking prowess and defensive solidity.
                </p>
            </section>

            <!-- Data Section -->
            <section id="data">
                <h2>üìÅ Dataset Information</h2>
                <div class="data-info">
                    <h3>Data Source and Size</h3>
                    <p><strong>Source:</strong> Football statistics from the 2024-2025 season across Europe's top five leagues</p>
                    <p><strong>Size:</strong> 2,000+ player records</p>
                    <p><strong>Attributes:</strong> 15+ features including Player Name, Age, Squad, Competition, Minutes Played (Min), Goals (Gls), Assists (Ast), Expected Goals (xG), 90-minute metrics (90s), Position (Pos), and derived features such as goals per minute, shots per 90, and conversion rates</p>
                    <p><strong>Leagues Covered:</strong> English Premier League, Spanish La Liga, Italian Serie A, German Bundesliga, and French Ligue 1</p>
                    <p><strong>Time Period:</strong> 2024-2025 Season</p>
                </div>
                <p>
                    The dataset combines both categorical features (player names, teams, positions, leagues) and continuous numerical features (minutes played, goals, assists, xG values). This mix allows for rich multi-dimensional analysis. The data has been preprocessed to calculate efficiency metrics such as goals per minute and shot conversion rates, enabling comparative analysis across players with different amounts of playing time.
                </p>
            </section>

            <!-- References Section -->
            <section id="references">
                <h2>üìö References</h2>
                <div class="references">
                    <a href="https://fbref.com/en/" target="_blank">üîó FBref - Football Statistics and Analytics</a>
                    <a href="https://statsbomb.com/articles/" target="_blank">üîó StatsBomb - Advanced Football Analytics Research</a>
                </div>
            </section>

            <!-- Visualization 1: Bar Chart -->
            <section id="viz1">
                <h2>üìä Visualization 1: Top Scorers by Efficiency</h2>
                <div class="chart-container">
                    <div class="chart-title">Top 10 Players by Goals per Minute</div>
                    <p class="chart-description">
                        <strong>Interaction:</strong> Use the slider below to filter players by minimum goals scored. The chart updates dynamically to show the most efficient scorers who meet your criteria.
                    </p>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Minimum Goals:</span>
                            <span id="minGoalsValue">0</span>
                        </div>
                        <input type="range" id="goalsSlider" min="0" max="30" value="0" step="1">
                    </div>
                    <div id="barChart"></div>
                    <p style="margin-top: 20px;">
                        <strong>Key Takeaway:</strong> This visualization reveals that scoring efficiency (goals per minute) doesn't always correlate with total goals scored. Players with limited minutes but high goal tallies often show remarkable efficiency. The color coding by league allows us to identify which competitions produce the most efficient scorers. Notice how elite strikers maintain high efficiency even with significant playing time, indicating consistent performance under various match conditions.
                    </p>
                </div>
            </section>

            <!-- Visualization 2: Scatter Plot -->
            <section id="viz2">
                <h2>üìä Visualization 2: Shot Efficiency Analysis</h2>
                <div class="chart-container">
                    <div class="chart-title">Shot Conversion Rate vs Shots per 90 Minutes</div>
                    <p class="chart-description">
                        <strong>Interaction:</strong> Hover over any point to see detailed player statistics including estimated shots, conversion rate, and league affiliation.
                    </p>
                    <div id="scatterPlot"></div>
                    <p style="margin-top: 20px;">
                        <strong>Key Takeaway:</strong> This scatter plot reveals the trade-off between shot volume and efficiency. Players who take fewer shots per 90 minutes often display higher conversion rates, suggesting more selective shooting. Conversely, high-volume shooters may have lower conversion rates but contribute through sheer opportunity creation. The visualization helps identify "clinical finishers" (high conversion, moderate volume) versus "volume scorers" (high shots, moderate conversion). League patterns also emerge, with some competitions favoring different playing styles.
                    </p>
                </div>
            </section>

            <!-- Visualization 3: Goals vs xG -->
<!-- Visualization 3: Goals vs xG -->
<section id="viz3">
  <h2>üìä Visualization 3: Performance vs Expectation</h2>
  <div class="chart-container">
    <div class="chart-title">Goals Scored vs Expected Goals (xG)</div>
    <p class="chart-description">
      <strong>Interaction:</strong> Click on league names in the legend to filter by competition. Hover over points to see player details.
    </p>

    <!-- Container adjusted for full y-axis visibility -->
    <div style="position: relative; min-width: 1200px; overflow: visible;">
      <iframe
        src="soccer_analytics_plot.html"
        width="1200"
        height="1000"
        frameborder="0"
        style="display: block; border: 0;"
        onload="this.style.display='block'"
        onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
      </iframe>

      <!-- Fallback if iframe fails to load -->
      <div style="display: none; padding: 40px; text-align: center; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
        <p><strong>‚ö†Ô∏è Visualization not available</strong></p>
        <p>Please ensure <code>soccer_analytics_plot.html</code> is in the same folder.</p>
      </div>
    </div>

    <p style="margin-top: 20px;">
      <strong>Key Takeaway:</strong> The relationship between actual goals and expected goals (xG) reveals which players are over-performing or under-performing relative to the quality of chances they receive. Players significantly above the diagonal line are clinical finishers who convert chances at rates better than expected. Those below the line may be experiencing poor form or facing exceptional goalkeeping. This metric is crucial for identifying sustainable performance versus temporary hot or cold streaks.
    </p>
  </div>
</section>



            <!-- Visualization 4: Radar Comparison -->
            <section id="viz4">
                <h2>üìä Visualization 4: Multi-Dimensional Player Comparison</h2>
                <div class="chart-container">
                    <div class="chart-title">Attacking Players Radar Chart</div>
                    <p class="chart-description">
                        <strong>Interaction:</strong> Search for and select up to two players to compare their attacking statistics across multiple dimensions. The radar chart normalizes all metrics to show relative strengths.
                    </p>
                    <div style="position: relative;">
                        <iframe src="attacking_players_radar.html" width="100%" height="750" frameborder="0"
                                onload="this.style.display='block'" 
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"
                                style="display: none; border: 1px solid #ddd; border-radius: 8px;"></iframe>
                        <div style="display: none; padding: 40px; text-align: center; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
                            <p><strong>‚ö†Ô∏è Visualization not available</strong></p>
                            <p>Please ensure <code>attacking_players_radar_fixed.html</code> is in the same folder.</p>
                        </div>
                    </div>
                    <p style="margin-top: 20px;">
                        <strong>Key Takeaway:</strong> Radar charts excel at showing player profiles across multiple dimensions simultaneously. They reveal whether a player is a complete attacking threat or has specific strengths. For instance, some forwards may excel in goals and assists but have moderate involvement in progressive carries, while others contribute heavily to build-up play. This visualization is invaluable for tactical planning and recruitment, as it quickly identifies complementary skill sets or direct positional competitors.
                    </p>
                </div>
            </section>

            <!-- Visualization 5: Bubble Chart -->
            <section id="viz5">
                <h2>üìä Visualization 5: Cross-League Performance Patterns</h2>
                <div class="chart-container">
                    <div class="chart-title">Player Performance Bubble Chart</div>
                    <p class="chart-description">
                        <strong>Interaction:</strong> Explore player performance across leagues with interactive bubble visualization. Hover over bubbles for detailed player information.
                    </p>
                    <div style="position: relative;">
                        <iframe src="player_performance_bubble.html" width="100%" height="700" frameborder="0" 
                                onload="this.style.display='block'" 
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"
                                style="display: none; border: 1px solid #ddd; border-radius: 8px;"></iframe>
                        <div style="display: none; padding: 40px; text-align: center; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
                            <p><strong>‚ö†Ô∏è Visualization not available</strong></p>
                            <p>Please ensure <code>player_performance_bubble.html</code> is in the same folder.</p>
                        </div>
                    </div>
                    <p style="margin-top: 20px;">
                        <strong>Key Takeaway:</strong> League-level analysis reveals that different competitions foster different playing styles. Some leagues emphasize possession and shot selection (La Liga), while others favor high-tempo, high-volume attacking (Premier League, Bundesliga). Understanding these contextual factors is crucial when comparing players across leagues or evaluating transfer targets. A player's statistics must be interpreted within their league's competitive context. The bubble chart allows for multi-dimensional comparison, showing relationships between goals, assists, and playing time across all five major European leagues.
                    </p>
                </div>
            </section>

            <!-- Summary and Findings -->
            <section id="summary">
                <h2>üéØ Summary and Key Findings</h2>
                <div class="key-findings">
                    <h3>Main Discoveries</h3>
                    <ul>
                        <li><strong>Efficiency Over Volume:</strong> Goals per minute proves to be a more insightful metric than total goals for identifying the most clinical finishers. Many players with moderate goal totals demonstrate exceptional efficiency when accounting for playing time, suggesting high impact as substitutes or rotation players.</li>
                        
                        <li><strong>Shot Quality vs Quantity:</strong> The scatter plot analysis reveals that higher conversion rates typically correlate with more selective shooting. Players who average 3-4 shots per 90 minutes often maintain conversion rates above 15%, while high-volume shooters (5+ shots per 90) rarely exceed 12% conversion. This suggests that shot selection is a trainable skill that significantly impacts scoring efficiency.</li>
                        
                        <li><strong>League-Specific Patterns:</strong> Different leagues exhibit distinct characteristics. The Premier League shows the highest shot volumes but moderate conversion rates, while La Liga demonstrates more selective shooting with better conversion. Serie A players tend toward tactical discipline with lower overall shot volumes. These patterns reflect broader tactical philosophies and coaching approaches across competitions.</li>
                    </ul>
                    
                    <h3>Future Research Directions</h3>
                    <ul>
                        <li><strong>Temporal Analysis:</strong> Extending this analysis to track performance changes throughout the season could reveal momentum patterns, fatigue effects, and form curves. This would help identify players who start strong versus those who finish seasons strongly.</li>
                        
                        <li><strong>Contextual Factors:</strong> Incorporating match context (home/away, opponent strength, match importance) would provide deeper insights into when and how players perform best. This could inform tactical decisions about player selection for specific match scenarios.</li>
                        
                        <li><strong>Defensive Metrics Integration:</strong> While this project focuses on attacking metrics, future work should integrate defensive contributions to provide complete player profiles. This would enable more holistic comparisons and better understand players' overall value to their teams.</li>
                    </ul>
                </div>
            </section>
        </div>

        <footer>
            <p>&copy; 2024 Football Analytics Project | DS4200: Information Presentation and Data Visualization</p>
            <p>Data source: European Football Statistics 2024-2025 Season</p>
        </footer>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Global variables
        let allData = [];
        let minGoalsFilter = 0;

        // League mapping
        function getLeague(team) {
            const teamLower = team.toLowerCase();
            const premierLeagueTeams = ['arsenal', 'aston villa', 'bournemouth', 'brentford', 'brighton', 'chelsea', 'crystal palace', 'everton', 'fulham', 'leicester city', 'liverpool', 'manchester city', 'manchester utd', 'newcastle utd', 'nott\'ham forest', 'tottenham', 'west ham', 'wolves'];
            const laLigaTeams = ['alav√©s', 'athletic club', 'atl√©tico madrid', 'barcelona', 'betis', 'celta vigo', 'espanyol', 'getafe', 'girona', 'las palmas', 'legan√©s', 'mallorca', 'osasuna', 'rayo vallecano', 'real madrid', 'real sociedad', 'sevilla', 'valencia', 'valladolid', 'villarreal'];
            const serieATeams = ['atalanta', 'bologna', 'como', 'empoli', 'fiorentina', 'genoa', 'inter', 'juventus', 'lazio', 'milan', 'monza', 'napoli', 'parma', 'roma', 'torino', 'udinese', 'venezia', 'verona', 'hellas verona'];
            const bundesligaTeams = ['augsburg', 'bayern munich', 'bayer leverkusen', 'leverkusen', 'borussia dortmund', 'dortmund', 'freiburg', 'hoffenheim', 'mainz 05', 'st. pauli', 'werder bremen', 'wolfsburg', 'eint frankfurt', 'frankfurt'];
            const ligue1Teams = ['angers', 'auxerre', 'brest', 'lens', 'lille', 'lyon', 'marseille', 'monaco', 'montpellier', 'nantes', 'nice', 'psg', 'paris saint-germain', 'reims', 'rennes', 'saint-√©tienne', 'strasbourg', 'toulouse'];
            
            if (premierLeagueTeams.some(t => teamLower.includes(t))) return 'Premier League';
            if (laLigaTeams.some(t => teamLower.includes(t))) return 'La Liga';
            if (serieATeams.some(t => teamLower.includes(t))) return 'Serie A';
            if (bundesligaTeams.some(t => teamLower.includes(t))) return 'Bundesliga';
            if (ligue1Teams.some(t => teamLower.includes(t))) return 'Ligue 1';
            return 'Other';
        }

        const leagueColors = {
            'Premier League': '#38003c',
            'La Liga': '#ff6900',
            'Serie A': '#0068a8',
            'Bundesliga': '#d20026',
            'Ligue 1': '#1d3557',
            'Other': '#999999'
        };

        function getLeagueColor(league) {
            return leagueColors[league] || leagueColors['Other'];
        }

        // Load and parse CSV data
        const possibleFiles = [
            "players_data_light-2024_2025.csv",
            "players_data-2024_2025.csv",
            "data/players_data_light-2024_2025.csv"
        ];
        
        async function loadData() {
            for (const filename of possibleFiles) {
                try {
                    const data = await d3.csv(filename);
                    console.log(`Successfully loaded: ${filename}`);
                    return data;
                } catch (error) {
                    console.log(`Could not load: ${filename}`);
                }
            }
            throw new Error("Could not find CSV file. Please check the filename and location.");
        }
        
        loadData().then(function(data) {
            data.forEach(function(d) {
                d.Min = +d.Min || 0;
                d.Gls = +d.Gls || 0;
                d.xG = +d.xG || 0;
                d["90s"] = +d["90s"] || 0;
                d.Age = +d.Age || null;
                d.Squad = d.Squad || "Unknown";
                d.Pos = d.Pos || "Unknown";
                d.League = getLeague(d.Squad);
                d.LeagueColor = getLeagueColor(d.League);
                d.goalsPerMin = d.Min > 0 ? d.Gls / d.Min : 0;
                
                const avgXGPerShot = 0.12;
                if (d.xG > 0) {
                    d.shots = d.xG / avgXGPerShot;
                } else if (d.Gls > 0) {
                    d.shots = d.Gls / 0.1;
                } else {
                    d.shots = 0;
                }
                
                d.shotsPer90 = d["90s"] > 0 ? (d.shots / d["90s"]) : 0;
                d.conversionRate = d.shots > 0 ? (d.Gls / d.shots) * 100 : 0;
            });
            
            allData = data.filter(d => d.Min > 0);
            initBarChart();
            initScatterPlot();
            setupSlider();
        }).catch(error => {
            console.error("Error loading data:", error);
            document.getElementById("barChart").innerHTML = `
                <div style="padding: 40px; text-align: center; color: #d32f2f;">
                    <h3>‚ö†Ô∏è Data Loading Error</h3>
                    <p>Could not find the CSV file. Please make sure <strong>players_data_light-2024_2025.csv</strong> is in the same folder as this HTML file.</p>
                    <p style="font-size: 0.9em; color: #666;">Current files tried:</p>
                    <ul style="list-style: none; font-size: 0.9em; color: #666;">
                        <li>‚Ä¢ players_data_light-2024_2025.csv</li>
                        <li>‚Ä¢ players_data-2024_2025.csv</li>
                        <li>‚Ä¢ data/players_data_light-2024_2025.csv</li>
                    </ul>
                </div>
            `;
            document.getElementById("scatterPlot").innerHTML = `
                <div style="padding: 40px; text-align: center; color: #d32f2f;">
                    <p>Data file not found.</p>
                </div>
            `;
        });

        function setupSlider() {
            const slider = d3.select("#goalsSlider");
            const valueDisplay = d3.select("#minGoalsValue");
            
            slider.on("input", function() {
                minGoalsFilter = +this.value;
                valueDisplay.text(minGoalsFilter);
                updateBarChart();
            });
        }

        function initBarChart() {
            const margin = {top: 40, right: 180, bottom: 60, left: 100};
            const width = 900 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;
            
            d3.select("#barChart").selectAll("*").remove();
            
            const svg = d3.select("#barChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            window.barChartSVG = svg;
            window.barChartG = g;
            window.barChartMargin = margin;
            window.barChartWidth = width;
            window.barChartHeight = height;
            
            updateBarChart();
        }

        function updateBarChart() {
            const margin = window.barChartMargin;
            const width = window.barChartWidth;
            const height = window.barChartHeight;
            const g = window.barChartG;
            
            const filteredData = allData
                .filter(d => d.Gls >= minGoalsFilter)
                .sort((a, b) => b.goalsPerMin - a.goalsPerMin)
                .slice(0, 10);
            
            g.selectAll(".bar").remove();
            g.selectAll(".axis").remove();
            g.selectAll("text.bar-label").remove();
            g.selectAll(".legend").remove();
            
            if (filteredData.length === 0) {
                g.append("text")
                    .attr("x", width / 2)
                    .attr("y", height / 2)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "18px")
                    .attr("fill", "#999")
                    .text("No players match the filter criteria");
                return;
            }
            
            const xScale = d3.scaleLinear()
                .domain([0, d3.max(filteredData, d => d.goalsPerMin)])
                .range([0, width])
                .nice();
            
            const yScale = d3.scaleBand()
                .domain(filteredData.map(d => d.Player))
                .range([0, height])
                .padding(0.2);
            
            const xAxis = d3.axisBottom(xScale).tickFormat(d3.format(".6f"));
            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", 45)
                .attr("text-anchor", "middle")
                .text("Goals per Minute");
            
            const yAxis = d3.axisLeft(yScale);
            g.append("g")
                .attr("class", "axis")
                .call(yAxis)
                .selectAll("text")
                .style("font-size", "11px");
            
            const tooltip = d3.select("#tooltip");
            
            g.selectAll(".bar")
                .data(filteredData)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", 0)
                .attr("y", d => yScale(d.Player))
                .attr("width", d => xScale(d.goalsPerMin))
                .attr("height", yScale.bandwidth())
                .attr("fill", d => d.LeagueColor)
                .on("mouseover", function(event, d) {
                    d3.select(this).attr("opacity", 0.8);
                    tooltip
                        .style("opacity", 1)
                        .html(`<strong>${d.Player}</strong><br/>Team: ${d.Squad}<br/>League: ${d.League}<br/>Position: ${d.Pos}<br/>Goals: ${d.Gls}<br/>Minutes: ${d.Min}<br/>Goals/Min: ${d.goalsPerMin.toFixed(6)}<br/>Goals/90: ${(d.Gls / d["90s"]).toFixed(2)}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this).attr("opacity", 1);
                    tooltip.style("opacity", 0);
                });
            
            g.selectAll("text.bar-label")
                .data(filteredData)
                .enter()
                .append("text")
                .attr("class", "bar-label")
                .attr("x", d => xScale(d.goalsPerMin) + 5)
                .attr("y", d => yScale(d.Player) + yScale.bandwidth() / 2)
                .attr("dy", "0.35em")
                .attr("font-size", "10px")
                .attr("fill", "#333")
                .text(d => `${d.Gls} goals`);
            
            addBarChartLegend(g, width, height, margin);
        }

        function addBarChartLegend(g, width, height, margin) {
            const legendX = width + 20;
            const legendY = 20;
            const legendItemHeight = 20;
            const uniqueLeagues = Array.from(new Set(allData.map(d => d.League))).sort();
            
            const legend = g.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${legendX},${legendY})`);
            
            legend.append("text")
                .attr("class", "legend-title")
                .attr("x", 0)
                .attr("y", 0)
                .attr("font-weight", "bold")
                .attr("font-size", "12px")
                .text("League:");
            
            const legendItems = legend.selectAll(".legend-item")
                .data(uniqueLeagues)
                .enter()
                .append("g")
                .attr("class", "legend-item")
                .attr("transform", (d, i) => `translate(0,${(i + 1) * legendItemHeight})`);
            
            legendItems.append("rect")
                .attr("width", 15)
                .attr("height", 15)
                .attr("fill", d => getLeagueColor(d));
            
            legendItems.append("text")
                .attr("x", 20)
                .attr("y", 12)
                .attr("font-size", "11px")
                .text(d => d);
        }

        function initScatterPlot() {
            const margin = {top: 40, right: 180, bottom: 80, left: 100};
            const width = 900 - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;
            
            const svg = d3.select("#scatterPlot")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            const scatterData = allData.filter(d => d.shots > 0 && d["90s"] > 0 && d.shotsPer90 > 0);
            
            const xScale = d3.scaleLinear()
                .domain(d3.extent(scatterData, d => d.shotsPer90))
                .range([0, width])
                .nice();
            
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(scatterData, d => d.conversionRate)])
                .range([height, 0])
                .nice();
            
            const xGridLines = d3.axisBottom(xScale).tickSize(-height).tickFormat("").ticks(10);
            const yGridLines = d3.axisLeft(yScale).tickSize(-width).tickFormat("").ticks(10);
            
            g.append("g")
                .attr("class", "grid-line")
                .attr("transform", `translate(0,${height})`)
                .call(xGridLines);
            
            g.append("g")
                .attr("class", "grid-line")
                .call(yGridLines);
            
            const xAxis = d3.axisBottom(xScale).ticks(10);
            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", 50)
                .attr("text-anchor", "middle")
                .text("Shots per 90 Minutes");
            
            const yAxis = d3.axisLeft(yScale).ticks(10).tickFormat(d => d + "%");
            g.append("g")
                .attr("class", "axis")
                .call(yAxis)
                .append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", -60)
                .attr("x", -height / 2)
                .attr("text-anchor", "middle")
                .text("Shot Conversion Rate (%)");
            
            const tooltip = d3.select("#tooltip");
            
            g.selectAll(".point")
                .data(scatterData)
                .enter()
                .append("circle")
                .attr("class", "point")
                .attr("cx", d => xScale(d.shotsPer90))
                .attr("cy", d => yScale(d.conversionRate))
                .attr("r", 4)
                .attr("fill", d => d.LeagueColor)
                .attr("stroke", "#fff")
                .attr("stroke-width", 0.5)
                .attr("opacity", 0.7)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .attr("r", 6)
                        .attr("opacity", 1)
                        .attr("stroke-width", 1.5);
                    
                    tooltip
                        .style("opacity", 1)
                        .html(`<strong>${d.Player}</strong><br/>Team: ${d.Squad}<br/>League: ${d.League}<br/>Position: ${d.Pos}<br/>Goals: ${d.Gls}<br/>Estimated Shots: ${d.shots.toFixed(1)}<br/>Shots/90: ${d.shotsPer90.toFixed(2)}<br/>Conversion Rate: ${d.conversionRate.toFixed(1)}%`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this)
                        .attr("r", 4)
                        .attr("opacity", 0.7)
                        .attr("stroke-width", 0.5);
                    tooltip.style("opacity", 0);
                });
            
            addScatterLegend(g, width, height, margin);
            
            svg.append("text")
                .attr("x", (width + margin.left + margin.right) / 2)
                .attr("y", 20)
                .attr("text-anchor", "middle")
                .attr("font-size", "14px")
                .attr("fill", "#666")
                .text("Note: Shots are estimated from Expected Goals (xG) data");
        }

        function addScatterLegend(g, width, height, margin) {
            const legendX = width + 20;
            const legendY = 20;
            const legendItemHeight = 20;
            const uniqueLeagues = Array.from(new Set(allData.map(d => d.League))).sort();
            
            const legend = g.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${legendX},${legendY})`);
            
            legend.append("text")
                .attr("class", "legend-title")
                .attr("x", 0)
                .attr("y", 0)
                .attr("font-weight", "bold")
                .attr("font-size", "12px")
                .text("League:");
            
            const legendItems = legend.selectAll(".legend-item")
                .data(uniqueLeagues)
                .enter()
                .append("g")
                .attr("class", "legend-item")
                .attr("transform", (d, i) => `translate(0,${(i + 1) * legendItemHeight})`);
            
            legendItems.append("circle")
                .attr("r", 6)
                .attr("cx", 7)
                .attr("cy", 7)
                .attr("fill", d => getLeagueColor(d))
                .attr("stroke", "#fff")
                .attr("stroke-width", 0.5);
            
            legendItems.append("text")
                .attr("x", 18)
                .attr("y", 11)
                .attr("font-size", "11px")
                .text(d => d);
        }
    </script>
</body>
</html>