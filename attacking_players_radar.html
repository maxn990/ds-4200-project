<!DOCTYPE html>
<html>
<head>
    <title>‚öΩ Attacking Players Radar Comparison</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #2d6a4f;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .player-select {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            position: relative;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d6a4f;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            border-color: #2d6a4f;
            box-shadow: 0 0 0 3px rgba(45, 106, 79, 0.1);
        }
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #2d6a4f;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        .suggestion-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .suggestion-item:hover {
            background: #e8f5e9;
        }
        .suggestion-item:last-child {
            border-bottom: none;
        }
        .player-info {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }
        #plotDiv {
            width: 100%;
            height: 650px;
        }
        .info {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #2d6a4f;
        }
        .error {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° Attacking Players Radar Comparison</h1>
        <div class="subtitle">Compare attacking stats for forwards and midfielders</div>
        
        <div class="controls">
            <div class="player-select">
                <label for="player1">üîç Search Player 1:</label>
                <input type="text" id="player1" placeholder="Type to search for a player..." autocomplete="off">
                <div id="suggestions1" class="suggestions"></div>
            </div>
            <div class="player-select">
                <label for="player2">üîç Search Player 2:</label>
                <input type="text" id="player2" placeholder="Type to search for a player..." autocomplete="off">
                <div id="suggestions2" class="suggestions"></div>
            </div>
        </div>
        
        <div id="message"></div>
        <div id="plotDiv"></div>
    </div>

    <script>
        // Global variables
        let playerData = [];
        let normalizedData = [];
        let playerList = [];
        
        const statCols = ['Min', 'Gls', 'Ast', 'KP', 'PrgC'];
        const displayNames = ['Minutes Played', 'Goals', 'Assists', 'Key Passes', 'Progressive Carries'];
        
        let selectedPlayer1 = '';
        let selectedPlayer2 = '';
        
        const player1Input = document.getElementById('player1');
        const player2Input = document.getElementById('player2');
        const suggestions1 = document.getElementById('suggestions1');
        const suggestions2 = document.getElementById('suggestions2');
        
        function showMessage(text, isError = false) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="info ${isError ? 'error' : ''}">${text}</div>`;
        }
        
        function normalizeValue(value, min, max) {
            if (max === min) return 50;
            return ((value - min) / (max - min)) * 100;
        }
        
        function normalizeData(data, cols) {
            const normalized = [];
            const mins = {};
            const maxs = {};
            
            // Calculate min and max for each column
            cols.forEach(col => {
                const values = data.map(d => parseFloat(d[col]) || 0);
                mins[col] = Math.min(...values);
                maxs[col] = Math.max(...values);
            });
            
            // Normalize each player
            data.forEach(player => {
                const normPlayer = {...player};
                cols.forEach(col => {
                    const val = parseFloat(player[col]) || 0;
                    normPlayer[col] = normalizeValue(val, mins[col], maxs[col]);
                });
                normalized.push(normPlayer);
            });
            
            return normalized;
        }
        
        // Load CSV data
        const csvFiles = [
            'players_data_light-2024_2025.csv',
            'players_data-2024_2025.csv',
            '../players_data_light-2024_2025.csv'
        ];
        
        async function loadCSV() {
            for (const file of csvFiles) {
                try {
                    const data = await d3.csv(file);
                    console.log(`Successfully loaded: ${file}`);
                    return data;
                } catch (error) {
                    console.log(`Failed to load: ${file}`);
                }
            }
            throw new Error('Could not load CSV file');
        }
        
        loadCSV().then(data => {
            // Filter for attacking players with minimum stats
            playerData = data.filter(d => {
                const mins = parseFloat(d.Min) || 0;
                const gls = parseFloat(d.Gls) || 0;
                return mins >= 500 && (gls > 0 || (parseFloat(d.Ast) || 0) > 0);
            });
            
            // Normalize the data
            normalizedData = normalizeData(playerData, statCols);
            
            // Create player list with safe strings
            playerList = playerData.map(p => ({
                name: p.Player || 'Unknown',
                squad: p.Squad || 'Unknown',
                pos: p.Pos || 'Unknown'
            })).sort((a, b) => a.name.localeCompare(b.name));
            
            showMessage('üîç Please search and select at least one player to see the comparison');
        }).catch(error => {
            console.error('Error loading data:', error);
            showMessage('‚ö†Ô∏è Could not load player data. Please ensure players_data_light-2024_2025.csv is in the same folder.', true);
        });
        
        function filterPlayers(searchText) {
            if (!searchText) return playerList;
            const lower = searchText.toLowerCase();
            return playerList.filter(player => 
                player.name.toLowerCase().includes(lower) ||
                player.squad.toLowerCase().includes(lower)
            );
        }
        
        function showSuggestions(inputElement, suggestionsElement, searchText) {
            const filtered = filterPlayers(searchText);
            
            if (filtered.length === 0 || !searchText) {
                suggestionsElement.style.display = 'none';
                return;
            }
            
            let html = '';
            filtered.slice(0, 10).forEach(player => {
                // Escape HTML to prevent injection
                const safeName = player.name.replace(/[<>]/g, '');
                const safeSquad = player.squad.replace(/[<>]/g, '');
                const safePos = player.pos.replace(/[<>]/g, '');
                
                html += `
                    <div class="suggestion-item" data-player="${safeName}">
                        <div>${safeName}</div>
                        <div class="player-info">${safeSquad} ‚Ä¢ ${safePos}</div>
                    </div>
                `;
            });
            
            suggestionsElement.innerHTML = html;
            suggestionsElement.style.display = 'block';
            
            // Add click handlers
            suggestionsElement.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', () => {
                    const playerName = item.getAttribute('data-player');
                    inputElement.value = playerName;
                    suggestionsElement.style.display = 'none';
                    
                    if (inputElement === player1Input) {
                        selectedPlayer1 = playerName;
                    } else {
                        selectedPlayer2 = playerName;
                    }
                    
                    updateChart();
                });
            });
        }
        
        function updateChart() {
            const selectedPlayers = [selectedPlayer1, selectedPlayer2].filter(p => p);
            
            if (selectedPlayers.length === 0) {
                showMessage('üîç Please search and select at least one player to see the comparison');
                document.getElementById('plotDiv').innerHTML = '';
                return;
            }
            
            document.getElementById('message').innerHTML = '';
            
            // Create traces
            const traces = selectedPlayers.map(playerName => {
                const normRow = normalizedData.find(row => row.Player === playerName);
                const actualRow = playerData.find(row => row.Player === playerName);
                
                if (!normRow || !actualRow) return null;
                
                const normValues = statCols.map(col => normRow[col] || 0);
                const actualValues = statCols.map(col => parseFloat(actualRow[col]) || 0);
                const hoverText = displayNames.map((name, i) => 
                    `${name}: ${actualValues[i].toFixed(1)}`
                );
                
                return {
                    type: 'scatterpolar',
                    r: normValues,
                    theta: displayNames,
                    fill: 'toself',
                    name: playerName,
                    hovertext: hoverText,
                    hoverinfo: 'text+name'
                };
            }).filter(t => t !== null);
            
            const layout = {
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 100],
                        ticksuffix: '%'
                    }
                },
                showlegend: true,
                title: '‚ö° Attacking Player Comparison',
                height: 650,
                font: {
                    family: 'Segoe UI, sans-serif',
                    size: 14
                }
            };
            
            Plotly.newPlot('plotDiv', traces, layout, {responsive: true});
        }
        
        // Event listeners for player 1
        player1Input.addEventListener('input', (e) => {
            showSuggestions(player1Input, suggestions1, e.target.value);
            if (e.target.value !== selectedPlayer1) {
                selectedPlayer1 = '';
                updateChart();
            }
        });
        
        player1Input.addEventListener('focus', (e) => {
            if (e.target.value) {
                showSuggestions(player1Input, suggestions1, e.target.value);
            }
        });
        
        // Event listeners for player 2
        player2Input.addEventListener('input', (e) => {
            showSuggestions(player2Input, suggestions2, e.target.value);
            if (e.target.value !== selectedPlayer2) {
                selectedPlayer2 = '';
                updateChart();
            }
        });
        
        player2Input.addEventListener('focus', (e) => {
            if (e.target.value) {
                showSuggestions(player2Input, suggestions2, e.target.value);
            }
        });
        
        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.player-select')) {
                suggestions1.style.display = 'none';
                suggestions2.style.display = 'none';
            }
        });
    </script>
</body>
</html>